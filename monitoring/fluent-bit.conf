[SERVICE]
    Flush         1
    Log_Level     info
    Daemon        off
    Parsers_File  parsers.conf
    HTTP_Server   On
    HTTP_Listen   0.0.0.0
    HTTP_Port     2020

# Input for Delta Bot application logs
[INPUT]
    Name              tail
    Path              /var/log/delta-bot/*.log
    Tag               delta-bot.app
    Parser            delta_bot_json
    Refresh_Interval  5

# Input for Docker container logs
[INPUT]
    Name              tail
    Path              /var/lib/docker/containers/*/*.log
    Tag               delta-bot.container
    Parser            docker
    Refresh_Interval  5

# Filter to add metadata
[FILTER]
    Name                record_modifier
    Match               delta-bot.*
    Record              service delta-bot
    Record              environment ${ENVIRONMENT:-development}
    Record              version ${VERSION:-latest}

# Filter to parse structured logs
[FILTER]
    Name                parser
    Match               delta-bot.app
    Key_Name            log
    Parser              delta_bot_structured
    Reserve_Data        On
    Preserve_Key        On

# Output to New Relic Logs via HTTP
[OUTPUT]
    Name                http
    Match               delta-bot.*
    Host                log-api.newrelic.com
    Port                443
    URI                 /log/v1
    Format              json
    tls                 on
    tls.verify          on
    Header              Api-Key ${NEW_RELIC_LICENSE_KEY}
    Header              Content-Type application/json